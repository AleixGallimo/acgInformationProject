<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qf.acgInformation.mapper.ICommentMapper">
    <resultMap id="commentMap" type="Comment">
        <id property="cId" column="c_id" />
        <result property="cText" column="c_text"/>
        <result property="cPic" column="c_pic"/>
        <result property="cUid" column="c_uid"/>
        <result property="cAid" column="c_aid"/>

        <collection
                property="user"
                ofType="User"
                column="c_uid"
                select="com.qf.acgInformation.mapper.IUserMapper.findUserById"
        />
        <collection
                property="messages"
                ofType="Message"
                column="c_id"
                select="com.qf.acgInformation.mapper.IMessageMapper.getMessageByCid"
        />
    </resultMap>

    <select id="getCommentByArticleId" resultMap="commentMap">
        select * from comment where c_aid = #{articleId} and is_delete = 1 limit #{offset},#{pageSize};
    </select>

    <select id="getAllComment" resultMap="commentMap">
        select * from comment where is_delete = 1;
    </select>

    <select id="getAllCommentCountByArticleId" resultType="Integer">
        select count(c_id) from comment where c_aid = #{articleId} and is_delete = 1;
    </select>

    <update id="deleteCommentByCommentId">
        update comment set is_delete = 0 where c_id = #{commentId};
    </update>

    <insert id="addComment" parameterType="Comment">
        insert into comment(c_text, c_uid, c_aid) values(#{comment.cText}, #{comment.cUid}, #{comment.cAid});
    </insert>

    <select id="getCommentByUserId" resultMap="commentMap">
         select * from comment where c_uid = #{userId} and is_delete = 1;
    </select>

    <select id="getArticleTitleById" resultType="String">
        select a_title from article where a_id = #{articleId} and is_delete = 1;
    </select>
</mapper>
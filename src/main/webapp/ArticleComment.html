<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <!-- 编辑器 -->
    <script src="asserts/plugins/wangEditor/wangEditor.js"></script>
    <!-- 本地 css 样式 -->
    <link href="asserts/css/commentStyle.css" rel="stylesheet">
    <!-- 图标 -->
    <link href="https://at.alicdn.com/t/font_1546900_y8hdaf5oyp.css" rel="stylesheet">
    <style type="text/css">
        *:hover{cursor:default;}
        a{cursor:pointer;text-decoration:none;color: #404040;}
        a:link { color: #404040; text-decoration: none; }/* 未访问 */
        a:visited { color: #404040; text-decoration: none; }/*以访问*/
        a:hover {cursor:pointer; color: #00b0ff; text-decoration: none; }
        .aName{color: #0e90d2}
        .option a{color: #cecece}
        .option a:hover{color: #00b0ff}
        .replyMessage,.deleteMessage{color: #cecece}
        .go:hover{color: #00b0ff;}
    </style>
</head>
<body>
    <div class="top container-fluid">
        <div class="container">
            <div class="titleLogo">
                <img src="asserts/images/logoTitle.jpg" height="78" width="197">
            </div>
            <div class="menu-fix-box col-lg-6">
                <ul id="menu-navigation" class="menu">
                    <li><a href="index.html">首页</a></li>
                    <li><a class="type" name="动画">动画</a></li>
                    <li><a class="type" name="游戏">游戏</a></li>
                    <li><a class="type" name="音乐">音乐</a></li>
                    <li><a class="type" name="电影">电影</a></li>
                    <li><a class="type" name="cosplay">cosplay</a></li>
                </ul>
            </div>
            <div class="menu-message col-lg-3" style="text-align: right;float: right">
                <a class="myUserName" style="margin-right: 15px" href="userAccount.html"> </a>
                <a class="myMessages" href="myMessages.html" style="line-height: 80px;padding-right: 15px">消息 <span class="badge">42</span></a>
                <a href="/acgInformation/UserController/logout">注销</a>
            </div>
        </div>
    </div>
    <div class="container" >
        <!-- 左边模块 -->
        <div class="left col-lg-8">
            <!-- 文章模块 -->
            <div class="article">
                <div class="catalog col-lg-12"></div>
                <div class="type col-lg-12">
                    <button type="button" class="btnType btn btn-primary">游戏</button>
                    <button type="button" class="btnType btn btn-success">动漫</button>
                    <button type="button" class="btnType btn btn-info">二次元</button>
                    <button type="button" class="btnType btn btn-warning">另类</button>
                    <button type="button" class="btnType btn btn-danger">十八禁</button>
                </div>
                <div class="title col-lg-12"></div>
                <div class="logo col-lg-12">
                    <span class="ico glyphicon glyphicon-time"></span><span class="time"></span>
                    <span class="ico glyphicon glyphicon-eye-open"></span><span class="read"></span>
                    <span class="ico glyphicon glyphicon-comment"></span><span class="commentCount"></span>
                    <span class="ico glyphicon glyphicon-heart"></span><span class="like"></span>
                </div>
                <hr style="border: #eeeeee solid 0.5px">
                <div class="articleContent">
                    <p class='articleP' style="text-indent: 30px;font-size: large;line-height:40px;color: #4a535b"></p>
                    <img src="asserts/images/undefined.jpg" class="contentImg">
                </div>

                <div class="myButton row" style="text-align: center;margin-top: 100px">
                    <button class="giveMoney btn btn-default" type="submit">打赏文章</button>
                    <button class="giveLike btn btn-default" type="submit">我喜欢</button>
                </div>
            </div>

            <a href="#" name="pageHead"></a>

            <!-- 评论模块 -->
            <div class="comments"></div>

            <!-- 分页模块 -->
            <div class="other">
                <!--分页-->
                <div style="text-align: center" class="upDownPage">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <li>
                                <a href="#pageHead" aria-label="Previous" id="up">
                                    <span aria-hidden="true">上一页</span>
                                </a>
                            </li>
                        </ul>
                        <ul class="pages pagination"></ul>
                        <ul class="pagination">
                            <li>
                                <a href="#pageHead" aria-label="Next" id="down">
                                    <span aria-hidden="true">下一页</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="row">
                    <div class="col-lg-3"></div>
                    <div class="eee col-lg-9">
                        <div id="editor"></div>
                    </div>
                </div>
                <div class="row" style="text-align: right">
                    <div class="col-lg-12">
                        <button type="button" class="enter btn btn-default">发表评论</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 右边模块 -->

        <div class="right col-lg-4">
            <div class="home col-lg-12"><!--authorObj-->
                <div class="rHeadPic">
                    <img class="img-circle" src="asserts/images/undefined.jpg" width="85" height="85">
                </div>
                <div class="rUserName">
                    <span> </span><span class="setting iconfont icon-V"></span>
                </div>
                <div class="uType">
                    <div class='iconfont icon icon-huiyuanjulebu' style='text-align: center;color: #f6c214;font-size: small;margin-top: 5px;'> 超级会员</div>
                </div>
                <div>

                </div>
            </div>
            <div class="news col-lg-12">
                <div class="nTitle">
                    <p>最新文章</p>
                </div>
                <div class="nContent">

                </div>
            </div>
        </div>
    </div>
    <div class="foot container-fluid">

    </div>

    <!-- 模态框 -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle"></h5>
                    <input type="hidden" name="data" id="data">
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" placeholder="请输入内容.." id="replyText">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="reply">回复</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 子评论回复模态框 -->
    <div class="modal fade" id="exampleModa2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle2"></h5>
                    <input type="hidden" name="data" id="data2">
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" placeholder="请输入内容.." id="replyText2">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="reply2">回复</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(function () {
            //编辑窗口对象
            var editor;
            //检查用户登录状态
            $.ajax({
                url:"/acgInformation/UserController/check",
                async:false,
                data:{},
                success:function (data) {
                    console.log(data)
                    if (data == 0){
                        location.href = "login.html?flag=false";
                        return;
                    }
                }
            })
            //加载当前用户
            var user = null;
            var fuser = null;
            if(user == null){
                $.ajax({
                    url:"/acgInformation/UserController/findUserById",
                    type:"GET",
                    async:false,
                    data:{},
                    success:function (data) {
                        user = JSON.parse(data);
                    }
                })
            }

            $(".myUserName").text(user.uName);
            //获取用户新未读消息
            var getRead = function () {
                $.ajax({
                    url:"/acgInformation/message/getNoReadCount",
                    data:{
                        userId:user.uId
                    },
                    async:false,
                    success:function (count) {
                        $(".badge").text(count);
                    }
                })
            }
            getRead();
            //当前文章id
            var articleId = getParams("aId");
            //当前用户权限
            var authority = user.uAuthority;
            //当前用户id
            var userId = user.uId;
            sessionStorage.setItem("user", JSON.stringify(user));
            //获取文章作者对象
            var author;
            var authorObj;

            //当前页数
            var thisPage = 1;
            //每页展示页数
            var pageSize = 5;
            //分页总页数
            var pageCount = 0;
            //评论总条数
            var commentCount = 0;

            var messageIndex;
            var messageArray = new Array();
            var messageDeleteArray = new Array();

            //解析url地址栏
            function getParams(key) {
                var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) {
                    return unescape(r[2]);
                }
                return null;
            };
            //获取文章方法
            var getArticle = function () {
                $.ajax({
                    url:"/acgInformation/article/getArticleById",
                    data:{
                        id:articleId
                    },
                    async:false,
                    success:function (data) {
                        var article = JSON.parse(data);
                        console.log("a" + article)
                        $("title").text(article.title);
                        author = article.aAuthor;
                        console.log("作者id" + author)
                        $(".catalog").text("首页 > " +  article.aType);
                        $(".title").text(article.title);
                        $(".time").text(article.aDate);
                        $(".read").text(article.aRead);
                        $(".like").text(article.aLike);
                        $(".contentImg").attr("src",article.aPic);
                        $(".articleP").text(article.aText);
                    }
                })
            }
            //获取文章作者对象方法
            var getAuthor = function () {
                console.log("作者编号"+ author);
                $.ajax({
                    url:"/acgInformation/UserController/findUser",
                    data:{
                        uid:author
                    },
                    async:false,
                    success:function (data) {
                        authorObj = JSON.parse(data);
                    }
                })
            }
            //设置文章作者
            var setAuthor = function () {
                console.log(authorObj)
                $(".rHeadPic img").attr("src","asserts/images/headPicture/" + authorObj.uPic);
                $(".rUserName span:first").text(authorObj.uName + " ");
                /*判定用户权限*/
                var uAuthority = authorObj.uAuthority;
                if (uAuthority == 2){
                    $(".uType").html("<div class='iconfont icon-huiyuanjulebu' style='text-align: center;color: #f6c214;font-size: small;margin-top: 5px;'> 超级会员</div>");
                } else if (uAuthority == 3) {+
                    $(".uType").html("<div class='iconfont icon-guanliyuan' style='text-align: center;color: #005dac;font-size: small;margin-top: 5px;'> 管理员</div>");
                } else {
                    $(".uType").html("<div class='iconfont icon-yonghu' style='text-align: center;color: #898989;font-size: small;margin-top: 5px;'> 普通用户</div>");
                }
            }

            //检查文章是否已被用户赞赏
            var checkUserMoney = function () {
                $.ajax({
                    url:"/acgInformation/collection/check",
                    data:{
                        articleId:articleId,
                        type:"money",
                    },
                    async:false,
                    dataTpye:"JSON",
                    success:function (value) {
                        console.log(value);
                        console.log(userId);
                        if (value == userId){
                            $(".giveMoney").attr("disabled","disabled");
                            $(".giveMoney").text("已打赏");
                            $(".giveMoney").attr("class", "giveMoney btn btn-danger");

                        }
                    }
                })
                $.ajax({
                    url:"/acgInformation/collection/check",
                    data:{
                        articleId:articleId,
                        type:"like",
                    },
                    async:false,
                    success:function (value) {
                        if (value == userId){
                            $(".giveLike").attr("disabled","disabled");
                            $(".giveLike").text("已点赞");
                            $(".giveLike").attr("class", "giveLike btn btn-danger");

                        }
                    }
                })
            }
            //获取评论方法
            var doAjax = function(){
                $(".newMessage").remove();
                $(".comment").remove();
                var offset = (thisPage - 1) * 5;
                $.ajax({
                    url:"/acgInformation/comment/getComment/" + offset + "/" + pageSize,
                    type:"GET",
                    data:{articleId:articleId},
                    async:false,
                    success:function (data) {
                        var data = JSON.parse(data);
                        console.log(data != "null")
                        if (data != "null"){
                            data = eval('(' + data + ')');
                            for (var i in data) {
                                fuser = data;
                                var comment = data[i];
                                user = data[i].user;
                                var messages = data[i].messages;
                                var temp = "" +
                                    "<div class='comment container-fluid'>\n" +
                                    "    <div class='user col-lg-3'>\n" +
                                    "        <div class='userHead'>\n" +
                                    "            <img src='asserts/images/headPicture/" + user.uPic + "' width='100' height='100' class='imgHead img-thumbnail'>\n" +
                                    "        </div>\n" +
                                    "        <div class='userName'>\n" +
                                    "            <div><a class='userNameHref'>" + user.uName +  "</a></div>\n" +
                                    "            <div class='authority'></div>\n" +
                                    "        </div>\n" +
                                    "    </div>\n" +
                                    "    <div class='content col-lg-9'>\n" +
                                    "        " + comment.cText + "\n" +
                                    "    </div>\n" +
                                    "    <div class='col-lg-3' style='height: 30px;'></div>\n" +
                                    "    <div class='option col-lg-9' uid='" + user.uId + "' cid='" + comment.cId + "' uname='" + user.uName + "'>\n" +
                                    "        <a class='replyComment' data-toggle='modal' data-target='#exampleModal'>回复</a> " +
                                    "       <a class='deleteComment'>删除</a>\n" +
                                    "    </div>\n" +
                                    "    <div class='messages col-lg-12'>\n" +
                                    "        <div class='col-lg-3' style='padding: 0'>" +
                                    "        </div>\n" +
                                    "        <div class='message col-lg-9' style='border-left: #ebebeb solid 1px;'>\n" +
                                    "        </div>\n" +
                                    "    </div>\n" +
                                    "</div>"

                                /*判定当前评论是否存在子评论，是则遍历，将评论存放在数组中*/
                                if (messages != ""){
                                    messageIndex = i;
                                    for (var j in messages){
                                        var m = messages[j];
                                        var message = "<div class='newMessage' " +
                                            "messageName='" + m.user.uName + "' " +
                                            "mUid='" + m.user.uId + "' " +
                                            "mCid='" + m.mCid + "' " +
                                            "mId='" + m.mId + "'>" +
                                            "<a class='aName'>" + m.user.uName + "</a>" + " : " + messages[j].mContent + " " +
                                            "<a class='deleteMessage' style='float: right;font-size: small;margin-right: 15px''>删除 </a>" +
                                            "<a class='replyMessage'  data-toggle='modal' data-target='#exampleModa2' style='float: right;font-size: small;margin-right: 5px''>回复</a>" +
                                            "</div>";
                                        messageArray[j] = message;
                                        if (m.mFid == userId){
                                            messageDeleteArray[j] = true;
                                        } else {
                                            messageDeleteArray[j] = false;
                                        }
                                    }
                                }
                                /*插入评论*/
                                $(".comments").append(temp);
                                /*判定评论是否由用户发出，true则允许删除评论*/
                                if (user.uId != userId){
                                    $(".deleteComment:eq(" + i + ")").css("display","none");
                                }
                                /*判定用户权限*/
                                var uAuthority = user.uAuthority;
                                if (uAuthority == 2){
                                    $(".authority:eq(" + i + ")").html("<div class='iconfont icon-huiyuanjulebu' style='text-align: center;color: #f6c214;font-size: small;margin-top: 5px;'> 超级会员</div>");
                                } else if (uAuthority == 3) {+
                                    $(".authority:eq(" + i + ")").html("<div class='iconfont icon-guanliyuan' style='text-align: center;color: #005dac;font-size: small;margin-top: 5px;'> 管理员</div>");
                                } else {
                                    $(".authority:eq(" + i + ")").html("<div class='iconfont icon-yonghu' style='text-align: center;color: #898989;font-size: small;margin-top: 5px;'> 普通用户</div>");
                                }

                                /*检查数组是否为空，不为空则插入前端页面*/
                                if (messageArray != ""){
                                    var messageTemp = "";
                                    for (var k in messageArray){
                                        messageTemp = messageTemp + messageArray[k];
                                    }
                                    $(".message:eq(" + messageIndex + ")").html("<hr style='border: #dddddd solid 0.5px;'>");
                                    $(".message:eq(" + messageIndex + ")").html(messageTemp);
                                    for (var x in messageDeleteArray){
                                        if(messageDeleteArray[x] != true ){
                                            $(".message:eq(" + messageIndex + ") .deleteMessage:eq(" + x + ")").css("display","none");
                                        }
                                    }
                                    messageDeleteArray = new Array();
                                    messageArray = new Array();
                                } else {
                                    $(".message:eq(" + i + ")").css("display","none");
                                }
                            }

                            /*加载分页数字*/
                            pages();
                        } else {
                            var temp = "<div class='comment container-fluid' style='text-align: center'><img src='asserts/images/noComment.jpg'></div>";
                            $(".comments").append(temp);
                            pages();
                        }

                        //回复评论
                        $(".replyComment").each(function (index) {
                            $(this).click(function () {
                                $("#replyText").val("");
                                var mUid = $(".option:eq(" + index + ")").attr("uid");
                                var mCid = $(".option:eq(" + index + ")").attr("cid");
                                var mFid = userId;

                                var json = "{'mUid':'" + mUid + "','mCid':'" + mCid + "','mFid':'" + mFid + "','mStatus':'comment',";
                                $("#data").val(json);
                                $("#modalTitle").text("回复用户: " + data[index].user.uName);
                            })
                        });
                        //回复子评论
                        $(".replyMessage").each(function (index) {
                            $(this).click(function () {
                                $("#replyText2").val("");
                                var mUid = $(".newMessage:eq(" + index + ")").attr("mUid");
                                var mCid = $(".newMessage:eq(" + index + ")").attr("mCid");
                                var mFid = userId;
                                var json = "{'mUid':'" + mUid + "','mCid':'" + mCid + "','mFid':'" + mFid + "','mStatus':'comment',";
                                $("#data2").val(json);
                                $("#modalTitle2").text("@" + $(this).parent().attr("messageName") + ": ");
                            })
                        });
                        //删除评论
                        $(".deleteComment").each(function (index) {
                            $(this).click(function () {
                                if(confirm("确实要删除吗？")){
                                    $.ajax({
                                        url:"/acgInformation/comment/deleteComment",
                                        data:{
                                            commentId:data[index].cId
                                        },
                                        success:function () {
                                            getPageCount();
                                            doAjax();
                                        }
                                    });
                                }
                            })
                        });
                        //删除子评论
                        $(".deleteMessage").each(function (index) {
                            $(this).click(function () {
                                if(confirm("确实要删除吗？")){
                                    $.ajax({
                                        url:"/acgInformation/message/delete",
                                        data:{
                                            messageId:$(".newMessage:eq(" + index + ")").attr("mId")
                                        },
                                        success:function () {
                                            getPageCount();
                                            doAjax();
                                        }
                                    })
                                }

                            })
                        });

                        $(".userNameHref").each(function (index) {
                            $(this).click(function () {
                                if (fuser[index].user.uId == userId){
                                    alert("您不能与自己聊天");
                                    return;
                                }
                                if(confirm('即将进入会话') == true){
                                    sessionStorage.setItem("uName", fuser[index].user.uName);
                                    location.href = "privateMessage.html?fId=" + fuser[index].user.uId;
                                }
                            })
                        })

                        $(".comment").each(function (index) {
                            $(this).mouseover(function () {
                                // $(this).css("box-shadow","1px 1px 10px #858585");
                                $(this).css("box-shadow","1px 1px 10px #cbcbcb");
                            })
                        })
                        $(".comment").each(function (index) {
                            $(this).mouseout(function () {
                                $(this).css("box-shadow","0 0 0 0");
                            })
                        })
                    }

                });
            }
            //分页数字方法
            var pages = function () {
                $(".page").remove();
                if (commentCount <= pageSize){
                    $(".upDownPage").css("display","none");
                    return;
                }
                $(".upDownPage").css("display","block");
                for (var i = 1;i <= pageCount;i++){
                    var item;
                    if (i == thisPage){
                        item = "<li class='page active'><a href='#pageHead' class='myPage'>" + i + "</a></li>";
                    } else {
                        item = "<li class='page'><a href='#pageHead' class='myPage'>" + i + "</a></li>";
                    }
                    $(".pages").append(item);
                }
                $(".myPage").each(function (i) {
                    $(this).click(function () {
                        if (i + 1 == thisPage){
                            return;
                        }
                        thisPage = $(this).text();
                        location.href = "#pageHead";
                        doAjax();
                    })
                })
            }
            //编辑框方法
            var wangEditor = function (){
                var E = window.wangEditor;
                editor = new E('#editor');
                //权限
                //工具栏权限判定
                if(authority == 2 || authority == 3){
                    editor.customConfig.menus = ['bold', 'fontName', 'italic', 'underline', 'strikeThrough', 'foreColor', 'backColor', 'justify', 'emoticon', 'image', 'code', 'undo', 'redo','qgs'];
                } else {
                    editor.customConfig.menus = ['emoticon', 'image', 'code', 'undo', 'redo', 'qgs'];
                }
                //表情框
                editor.customConfig.emotions = [
                    {
                        // tab 的标题
                        title: '默认',
                        // type -> 'emoji' / 'image'
                        type: 'image',
                        // content -> 数组
                        content : [{src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif", alt : "[草泥马]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif", alt : "[神马]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif", alt : "[浮云]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif", alt : "[给力]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif", alt : "[围观]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif", alt : "[威武]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif", alt : "[熊猫]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif", alt : "[兔子]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif", alt : "[奥特曼]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif", alt : "[囧]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif", alt : "[互粉]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif", alt : "[礼物]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif", alt : "[呵呵]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif", alt : "[嘻嘻]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6a/laugh.gif", alt : "[哈哈]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/14/tza_thumb.gif", alt : "[可爱]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/af/kl_thumb.gif", alt : "[可怜]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/a0/kbsa_thumb.gif", alt : "[挖鼻屎]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f4/cj_thumb.gif", alt : "[吃惊]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/shamea_thumb.gif", alt : "[害羞]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c3/zy_thumb.gif", alt : "[挤眼]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/29/bz_thumb.gif", alt : "[闭嘴]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/71/bs2_thumb.gif", alt : "[鄙视]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6d/lovea_thumb.gif", alt : "[爱你]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/9d/sada_thumb.gif", alt : "[泪]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/19/heia_thumb.gif", alt : "[偷笑]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/8f/qq_thumb.gif", alt : "[亲亲]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/b6/sb_thumb.gif", alt : "[生病]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/58/mb_thumb.gif", alt : "[太开心]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/17/ldln_thumb.gif", alt : "[懒得理你]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/98/yhh_thumb.gif", alt : "[右哼哼]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6d/zhh_thumb.gif", alt : "[左哼哼]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/a6/x_thumb.gif", alt : "[嘘]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/af/cry.gif", alt : "[衰]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/73/wq_thumb.gif", alt : "[委屈]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/9e/t_thumb.gif", alt : "[吐]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f3/k_thumb.gif", alt : "[打哈欠]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/27/bba_thumb.gif", alt : "[抱抱]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7c/angrya_thumb.gif", alt : "[怒]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/5c/yw_thumb.gif", alt : "[疑问]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/a5/cza_thumb.gif", alt : "[馋嘴]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/88_thumb.gif", alt : "[拜拜]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/e9/sk_thumb.gif", alt : "[思考]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/24/sweata_thumb.gif", alt : "[汗]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7f/sleepya_thumb.gif",}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6b/sleepa_thumb.gif", alt : "[睡觉]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/90/money_thumb.gif", alt : "[钱]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0c/sw_thumb.gif", alt : "[失望]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/40/cool_thumb.gif", alt : "[酷]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/8c/hsa_thumb.gif", alt : "[花心]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/49/hatea_thumb.gif", alt : "[哼]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/36/gza_thumb.gif", alt : "[鼓掌]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d9/dizzya_thumb.gif", alt : "[晕]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/1a/bs_thumb.gif", alt : "[悲伤]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/62/crazya_thumb.gif", alt : "[抓狂]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/91/h_thumb.gif", alt : "[黑线]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6d/yx_thumb.gif", alt : "[阴险]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/nm_thumb.gif", alt : "[怒骂]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/40/hearta_thumb.gif", alt : "[心]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ea/unheart.gif", alt : "[伤心]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/58/pig.gif", alt : "[猪头]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d6/ok_thumb.gif", alt : "[ok]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d9/ye_thumb.gif", alt : "[耶]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d8/good_thumb.gif", alt : "[good]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c7/no_thumb.gif", alt : "[不要]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d0/z2_thumb.gif", alt : "[赞]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/40/come_thumb.gif", alt : "[来]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d8/sad_thumb.gif", alt : "[弱]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/91/lazu_thumb.gif", alt : "[蜡烛]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6a/cake.gif", src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/d3/clock_thumb.gif", alt : "[钟]"}, {src : "http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/1b/m_thumb.gif", alt : "[话筒]"}]}]
                //创建编辑对象
                editor.create();
            }
            //评论总条数 & 分页总数方法
            var getPageCount = function () {
                $.ajax({
                    url:"/acgInformation/comment/all",
                    data:{articleId:articleId},
                    async:false,
                    success:function (data) {
                        commentCount = data;
                        pageCount = Math.ceil(commentCount / pageSize);
                    }
                });
                $(".commentCount").text(commentCount);
            }

            //判定第一次加载页面执行计算总评论条数方法
            if (commentCount == 0){
                getPageCount();
            }
            //加载所有方法
            $(document).ready(function () {
                getArticle();
                getAuthor();
                getArticleTime();
                doAjax();
                wangEditor();
                checkUserMoney();
                setAuthor();
            })
            sessionStorage.setItem("url",window.location.pathname + "?aId=" + articleId);
            //发表评论
            $(".enter").click(function () {
                var str = editor.txt.html();
                if (str == "<p><br></p>"){
                    return;
                }
                $.ajax({
                    url:"/acgInformation/comment/addComment",
                    type:"POST",
                    data:"{'cText':'" + str + "','cUid':'" + userId + "','cAid':'" + articleId + "'}",
                    contentType:"application/json;charset=UTF-8",
                    dataType:"JSON",
                    success:function (data) {
                        if (data != 0){
                            alert("评论发表成功!");
                            getPageCount();
                            thisPage = pageCount;
                            editor.txt.clear();
                            doAjax();
                            pages();
                        }
                    }
                })
            })

            //模态框点击提交
            $("#reply").click(function () {
                var data = $("#data").val() + ",'mContent':'" + $("#replyText").val() + "'}";
                if ($("#replyText").val() == ""){
                    return;
                }
                $.ajax({
                    url:"/acgInformation/message/add",
                    type:"POST",
                    async:false,
                    data:data,
                    contentType:"application/json;charset=UTF-8",
                    dataType:"JSON",
                    success:function (data) {
                        alert("回复成功！");
                        $("#editor").html("");
                        wangEditor();
                        doAjax();
                    }
                })
            })

            //子评论模态框点击提交
            $("#reply2").click(function () {
                var data = $("#data2").val() + ",'mContent':'" + $("#modalTitle2").text() + $("#replyText2").val() + "'}";
                if($("#replyText2").val() == ""){
                    return;
                }
                $.ajax({
                    url:"/acgInformation/message/add",
                    type:"POST",
                    async:false,
                    data:data,
                    contentType:"application/json;charset=UTF-8",
                    dataType:"JSON",
                    success:function (data) {
                        alert("回复成功！");
                        $("#editor").html("");
                        wangEditor();
                        doAjax();
                    }
                })
            })

            //点赞 打赏
            $(".giveMoney").click(function () {
                $.ajax({
                    url:"/acgInformation/RewardController/reward",
                    data:{
                        aAuthor:author
                    },
                    async:false,
                    dataType:"JSON",
                    success:function (flag) {
                        if (flag == 2){
                            alert("抱歉，您不能给自己打赏");
                        } else if (flag == 0){
                            alert("失败");
                        } else if(flag == -1){
                            if (confirm("'抱歉，您的余额不足,是否充值？'") == true){
                                location.href = "views/recharge.html";
                            }
                        } else {
                            debugger
                            $(".giveMoney").attr("class", "giveMoney btn btn-danger");
                            $(".giveMoney").attr("disabled","disabled");
                            $(".giveMoney").text("已打赏");
                            $.ajax({
                                url:"/acgInformation/collection/add",
                                data:{
                                    userId:userId,
                                    articleId:articleId,
                                    type:"money"
                                },
                                async:false
                            });

                        }
                    }

                });
            })
            $(".giveLike").click(function () {
                $.ajax({
                    url:"/acgInformation/article/addLike",
                    data:{
                        aId:articleId
                    },
                    success:function () {
                        $(".giveLike").attr("class", "giveLike btn btn-danger")
                        $(".giveLike").attr("disabled","disabled");
                        $(".giveLike").text("已点赞");
                        $.ajax({
                            url:"/acgInformation/collection/add",
                            data:{
                                userId:userId,
                                articleId:articleId,
                                type:"like"
                            }
                        });
                    }
                })
            })

            //上一页
            $("#up").click(function () {
                if (thisPage == 1){
                    return;
                } else {
                    thisPage = Number(thisPage) - 1;
                    doAjax();
                }
            })
            //下一页
            $("#down").click(function () {
                if (thisPage == pageCount){
                    return;
                } else {
                    thisPage = Number(thisPage) + 1;
                    doAjax();
                }
            });

            //获取时间文章
            var getArticleTime = function () {
                $.ajax({
                    url:"/acgInformation/article/load",
                    async:false,
                    success:function (data) {
                        data = JSON.parse(data);
                        for(var i = 0;i < 10;i++){
                            var temp = "" +
                                "<div class='new col-lg-12'>" +
                                "   <div class='col-lg-12' style='font-size: 16px'><a class='go'>" + data[i].title + "</a></div>" +
                                "   <div class='col-lg-12' style='text-align: right;margin-bottom: 5px;color: #dddddd'>" + data[i].aDate + "</div>" +
                                "</div>";
                            $(".nContent").append(temp);
                        }
                        $(".new").each(function (index) {
                            $(this).hover(function () {
                                $(".go:eq(" + index + ")").css("color","#00b0ff");
                            }, function () {
                                $(".go:eq(" + index + ")").css("color","#404040");
                            })
                            $(this).click(function () {
                                location.href = "ArticleComment.html?aId=" + data[index].aId;
                            })
                        })
                    }
                })
            }

            //导航栏跳转
            $(".type").each(function () {
                $(this).click(function () {
                    sessionStorage.setItem("type", JSON.stringify($(this).attr("name")));
                    location.href='type.html';
                })
            })
        })
    </script>

</body>
</html>
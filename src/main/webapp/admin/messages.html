<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>管理者模式</title>
        <link rel="stylesheet" href="../asserts/admin/css/bootstrap.css" />
        <link rel="stylesheet" href="../asserts/admin/css/bootstrap-responsive.css" />
        <link rel="stylesheet" href="../asserts/admin/css/styles.css" />
        <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
        <script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js"></script>
        <script type="text/javascript">
            $(function () {
                var offset = 0;
                var pageSize = 10;

                var commentCount = function () {

                }

                var doAjax = function () {
                    $("tbody tr").remove();
                    $.ajax({
                        url:"/acgInformation/comment/getAllComment",
                        type:"GET",
                        data:{
                            offset:0,
                            pageSize:10
                        },
                        async:false,
                        success:function (data) {
                            var data = eval('(' + JSON.parse(data) + ')');
                            console.log(data)
                            for (var i in data){
                                var aTitle = "";
                                var cName = data[i].user.uName;
                                console.log(cName)
                                $.ajax({
                                    url:"/acgInformation/comment/getArticleTitle",
                                    data:{
                                        articleId:data[i].cAid,
                                    },
                                    async:false,
                                    success:function (value) {
                                        aTitle = JSON.parse(value);
                                    }
                                })
                                var temp = "<tr>" +
                                    "           <td>" + (Number(i)+1) + "</td>" +
                                    "           <td>" + aTitle + "</td>" +
                                    "           <td>" + data[i].user.uId + "</td>" +
                                    "           <td>" + cName + "</td>" +
                                    "           <td width='300'>" + data[i].cText.replace(/<[^>]+>/g, "") + "</td>" +
                                    "           <td>" +
                                    "               <button type='button' class='delete btn btn-danger'>删除评论</button>" +
                                    "               <button type='button' class='benUser btn btn-warning'>禁言用户</button>" +
                                    "           </td>" +
                                    "       </tr>";
                                $("tbody").append(temp);
                            }
                            $(".delete").each(function (index) {
                                $(this).click(function () {
                                    if (confirm("确定删除评论吗?") == true){
                                        $.ajax({url:"/acgInformation/comment/deleteComment", data:{commentId:data[index].cId}, async:false});
                                        doAjax();
                                    }
                                })
                            })
                        }
                    });
                }
                doAjax();
            })
        </script>


    </head>

    <body>
    <!-- 导航 -->
    <div id="in-nav">
        <div class="container">
            <div class="row">
                <div class="span12">
                    <ul class="pull-right">
                        <li><a href="login.html">退出登录</a></li>
                    </ul>
                    <a id="logo" href="index.html">
                    <h4>My<strong>Admin</strong></h4></a>
                </div>
            </div>
        </div>
    </div>

    <!-- 菜单 -->
    <div id="in-sub-nav">
        <div class="container">
            <div class="row">
                <div class="span12">
                    <ul>
                        <li><a href="index.html"><i class="batch home"></i><br />主页</a></li>
                        <li><a href="messages.html" class="active"><i class="batch plane"></i><br />评论管理</a></li>
                        <li><a href="faq.article.html"><i class="batch forms"></i><br />文章管理</a></li>
                        <li><a href="users.html"><i class="batch users"></i><br />用户管理</a></li>
                        <li><a href="settings.html"><i class="batch settings"></i><br />资料更改</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 页面 -->
    <div class="page">
        <div class="page-container">
            <div class="container">
                    <div class="col-lg-12">
                        <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>编号</th>
                                <th>文章标题</th>
                                <th>用户编号</th>
                                <th>用户名称</th>
                                <th>评论内容</th>
                                <th>后台操作</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                        <tfoot></tfoot>
                    </table>
                    </div>

            </div>
        </div>
    </div>

    <!-- 底部 -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="span12">
                    <p class="pull-right">管理者后台</p>
                    <p>&copy; Copyright 2019 ACGInformation</p>
                </div>
            </div>
        </div>
    </footer>
  </body>
</html>